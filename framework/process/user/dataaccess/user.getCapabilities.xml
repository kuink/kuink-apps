<?xml version='1.0'?>
<Method>
    <Doc>
        Get the capabilities of a given user
    </Doc>
    <Params>
        <Param name="id_person"/>
        <Param name="id_company"/>
    </Params>
    <Body>
        <Sql>
            <![CDATA[        
                SELECT
                    c.id,
                    c.code,
                    c.name 
                FROM 
                    fw_user u
                    INNER JOIN fw_user_company uc ON (uc.id_user = u.id AND uc.id_person = {param->id_person} AND uc.id_company = '{param->id_company}')  
                    INNER JOIN fw_allocation a ON (a.id_user = u.id AND a.id_company = '{param->id_company}')
                    INNER JOIN fw_role r ON (r.id = a.id_role)
                    INNER JOIN fw_role_capability rc ON (rc.id_role = r.id)
                    INNER JOIN fw_capability c ON (c.id = rc.id_capability)
                ORDER BY  
                  c.code
        ]]>
        </Sql>
    </Body>
</Method>
