<?xml version="1.0" encoding="UTF-8"?>
<Node>
  <Permissions/>
  <Libraries>
    <Use name="DateTimeLib" type="lib"/>
  </Libraries>
  <Configuration/>
  <Screens/>
  <Actions>
    <Action name="init"/>
  </Actions>
  <Library>
    <Function name="addByCode" doc="Add an allocation to the user in a company">
      <Params>
        <Param name="company_code" type="text" required="true" doc="Company code"/>
        <Param name="role_code" type="text" required="true" doc="Role code"/>
        <Param name="person_uid" type="text" required="true" doc="Person username"/>
      </Params>
      <Return type="int" doc="the role id"/>
      <Errors>
        <Error code="-1" doc="Allocation allready exists"/>
      </Errors>
      <Begin>
        <!--Permissions>
            <Allow>
              <Capability name="framework/allocation::manage"/>
            </Allow>
          </Permissions-->
        <!-- Set default values -->
        <Try>
          <Instructions>
            <Var name="id">
              <Execute method="framework,user.allocation,allocation.addByCode">
                <Param name="company_code">
                  <Var name="company_code"/>
                </Param>
                <Param name="role_code">
                  <Var name="role_code"/>
                </Param>
                <Param name="person_uid">
                  <Var name="person_uid"/>
                </Param>
                <Param name="_creation">
                  <DateTimeLib method="Now"/>
                </Param>
                <Param name="_creation_ip">
                  <Var name="USER" key="ip"/>
                </Param>
              </Execute>
            </Var>
            <Var name="return">
              <Var name="id"/>
            </Var>
          </Instructions>
          <Catch>
            <Var name="return">-1</Var>
          </Catch>
        </Try>
        <Return>
          <Var name="return"/>
        </Return>
      </Begin>
    </Function>
    <Function name="add" doc="Adds a record in table ">
      <Params>
        <Param name="id_company" type="select" required="true"/>
        <Param name="id_user" type="select" required="true"/>
        <Param name="id_role" type="select" required="true"/>
      </Params>
      <Return type="int" doc="The inserted record id"/>
      <Begin>
        <Return>
          <Execute method="framework,generic,insert">
            <Param name="table">fw_allocation</Param>
            <Param name="id_company">
              <Var name="PARAMS" key="id_company"/>
            </Param>
            <Param name="id_user">
              <Var name="PARAMS" key="id_user"/>
            </Param>
            <Param name="id_role">
              <Var name="PARAMS" key="id_role"/>
            </Param>
            <Param name="_creation">
              <DateTimeLib method="Now"/>
            </Param>
            <Param name="_creation_ip">
              <Var name="USER" key="ip"/>
            </Param>
            <Param name="_modification">
              <DateTimeLib method="Now"/>
            </Param>
            <Param name="_modification_ip">
              <Var name="USER" key="ip"/>
            </Param>
          </Execute>
        </Return>
      </Begin>
    </Function>
    <Function name="delete" doc="Delete a record by id from table fw_allocation">
      <Params>
        <Param name="id" type="int" required="true"/>
      </Params>
      <Return type="int" doc=""/>
      <Begin>
        <Return>
          <Execute method="framework,generic,delete">
            <Param name="table">fw_allocation</Param>
            <Param name="id">
              <Var name="PARAMS" key="id"/>
            </Param>
          </Execute>
        </Return>
      </Begin>
    </Function>
    <Function name="update" doc="Updates a record in table fw_allocation">
      <Params>
        <Param name="id" type="int" required="true"/>
        <Param name="id_company" type="select" required="true"/>
        <Param name="id_user" type="select" required="true"/>
        <Param name="id_role" type="select" required="true"/>
      </Params>
      <Begin>
        <Var name="paramData">
          <UtilsLib method="filterNotNull">
            <Param>
              <Var name="PARAMS"/>
            </Param>
          </UtilsLib>
        </Var>
        <Execute method="framework,generic,update" params="paramData">
          <Param name="table">fw_allocation</Param>
          <Param name="_modification">
            <DateTimeLib method="Now"/>
          </Param>
          <Param name="_modification_ip">
            <Var name="USER" key="ip"/>
          </Param>
        </Execute>
      </Begin>
    </Function>
    <Function name="search" doc="Search records from table fw_allocation">
      <Params>
        <Param name="id" type="int"/>
        <Param name="id_company" type="select"/>
        <Param name="id_user" type="select"/>
        <Param name="id_role" type="select"/>
        <Param name="pagenum" type="int"/>
        <Param name="pagesize" type="int"/>
      </Params>
      <Return type="multiple" doc="">
        <External name="id" type="int" doc=""/>
        <External name="id_company" type="select" doc=""/>
        <External name="id_user" type="select" doc=""/>
        <External name="id_role" type="select" doc=""/>
        <External name="_creation" type="int" doc=""/>
        <External name="_creation_ip" type="text" doc=""/>
        <External name="_modification" type="int" doc=""/>
        <External name="_modification_ip" type="text" doc=""/>
      </Return>
      <Begin>
        <Return>
          <Execute method="this,this,search">
            <Param name="id">
              <Var name="PARAMS" key="id"/>
            </Param>
            <Param name="id_company">
              <Var name="PARAMS" key="id_company"/>
            </Param>
            <Param name="id_user">
              <Var name="PARAMS" key="id_user"/>
            </Param>
            <Param name="id_role">
              <Var name="PARAMS" key="id_role"/>
            </Param>
            <Param name="pagenum">
              <Var name="PARAMS" key="pagenum"/>
            </Param>
            <Param name="pagesize">
              <Var name="PARAMS" key="pagesize"/>
            </Param>
          </Execute>
        </Return>
      </Begin>
    </Function>
    <Function name="getAll" doc="Get all records from table fw_allocation">
      <Params/>
      <Return type="multiple" doc="">
        <External name="id" type="int" doc=""/>
        <External name="id_company" type="select" doc=""/>
        <External name="id_user" type="select" doc=""/>
        <External name="id_role" type="select" doc=""/>
        <External name="_creation" type="int" doc=""/>
        <External name="_creation_ip" type="text" doc=""/>
        <External name="_modification" type="int" doc=""/>
        <External name="_modification_ip" type="text" doc=""/>
      </Return>
      <Begin>
        <Return>
          <Execute method="framework,generic,getAll">
            <Param name="table">fw_allocation</Param>
            <Param name="fields">*</Param>
          </Execute>
        </Return>
      </Begin>
    </Function>
    <Function name="getById" doc="Get a record by id from table fw_allocation">
      <Params>
        <Param name="id" type="int" required="true"/>
      </Params>
      <Return type="single" doc="">
        <External name="id" type="int" doc=""/>
        <External name="id_company" type="select" doc=""/>
        <External name="id_user" type="select" doc=""/>
        <External name="id_role" type="select" doc=""/>
        <External name="_creation" type="int" doc=""/>
        <External name="_creation_ip" type="text" doc=""/>
        <External name="_modification" type="int" doc=""/>
        <External name="_modification_ip" type="text" doc=""/>
      </Return>
      <Begin>
        <Return>
          <Execute method="framework,generic,load">
            <Param name="table">fw_allocation</Param>
            <Param name="id">
              <Var name="PARAMS" key="id"/>
            </Param>
          </Execute>
        </Return>
      </Begin>
    </Function>
  </Library>
</Node>
