<?xml version='1.0'?>
<Method>
    <Doc>
        Get the roles of a given user
    </Doc>
    <Params>
        <Param name="company_code"/>
        <Param name="role_code"/>
        <Param name="person_uid"/>
        <Param name="_creation"/>
        <Param name="_creation_ip"/>
    </Params>
    <Body>
        <Execute>
            <![CDATA[   
                INSERT INTO `gecol`.`fw_allocation` (`id_company`,`id_user`,`id_role`,_creation, _creation_ip,_modification, _modification_ip) 
                SELECT c.id as id_company, u.id as id_user, r.id as id_role, {param->_creation} as _creation, '{param->_creation_ip}' as _creation_ip, {param->_creation} as _modification, '{param->_creation_ip}' as _modification_ip
                FROM
                    fw_company c, fw_role r, fw_user u, person p, fw_user_company uc
                WHERE
                    c.code = '{param->company_code}'
                AND r.code = '{param->role_code}'
                AND p.uid = '{param->person_uid}'
                AND r.id_company = c.id
                AND u.username = p.uid
                AND uc.id_user = u.id
                AND uc.id_company = c.id
        ]]>
        </Execute>
    </Body>
</Method>
