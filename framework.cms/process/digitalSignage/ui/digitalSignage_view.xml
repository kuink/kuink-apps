<?xml version="1.0" encoding="UTF-8"?>
<Node>
  <Permissions>
  </Permissions>
  <Doc lang="pt-PT">
  </Doc>
  <Libraries>
    <Use name="DateTimeLib" type="lib"/>
    <Use name="UtilsLib" type="lib"/>
  </Libraries>
  <Configuration/>
  <Params>
    <Param name="channel" doc="The channel to retrieve contents"/>
    <Param name="order" doc="The item order in the channel"/>
  </Params>
  <Screens>
    <Screen name="playScreen" doc="">
      <HtmlContainer name="contentHtml"/>
		</Screen>
  </Screens>

  <Actions>

    <Action name="init" screen="playScreen">
      <Var name="record">
        <Call library="framework,cms.digitalSignage,api" function="getChannelItem">
          <Param name="channel"><Var name="PARAMS" key="channel"/></Param>          
          <Param name="order"><Var name="PARAMS" key="order"/></Param>
        </Call>
      </Var>
      <Var name="total" process="true"><Var name="record" key="total"/></Var>

      <Var name="records"><Var name="record" key="records"/></Var>
      <Var name="currentItem" dump="true"><Var name="records" key="__first"/></Var>

      <Var name="data"><Set/></Var>
      <Var name="data" key="item"><Var name="currentItem"/></Var>
      <Var name="data" key="actionUrl"><Action.getUrl>next</Action.getUrl></Var>
      <Var name="data" key="device"><Var name="device" process="true"/></Var>
      <Var name="data" key="channel"><Var name="currentChannel" process="true"/></Var>
      <Var name="data" key="order"><Var name="order" process="true"/></Var>
      <Var name="data" key="total"><Var name="total" process="true"/></Var>

      <!-- <Var name="data" dump="true"/> -->
      <Var name="idChannel">
        <Call library="framework,cms.channel,api" function="getIdByCode">
          <Param name="code"><Var name="currentChannel" process="true"/></Param>
        </Call>
      </Var>

      <Var name="html" dump="true">
        <Call library="framework,cms.channel,api" function="getHtml">
          <Param name="id_channel"><Var name="idChannel"/></Param>
          <Param name="data"><Var name="data"/></Param>
        </Call>
      </Var>
      
      <!-- Clean content -->
      <Control method="bind" object="contentHtml">
        <Param><Var name="html"/></Param>
      </Control>
    </Action>

  </Actions>
  <Library/>
</Node>
